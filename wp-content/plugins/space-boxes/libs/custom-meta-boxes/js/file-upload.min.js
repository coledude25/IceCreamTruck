jQuery(document).ready(function(){jQuery(document).on("click",".cmb-file-upload",function(e){e.preventDefault();var t=jQuery(this),n=jQuery(this).parent(),r={multiple:!1,title:"Select File"};library=n.attr("data-type").split(",");library.length>0&&(r.library={type:library});var i=wp.media(r);i.on("select",function(){var e=i.state().get("selection"),r=e.first(),s=n.find(".cmb-file-holder");jQuery(n).find(".cmb-file-upload-input").val(r.id);t.hide();i.close();s.html("");s.show();s.siblings(".cmb-remove-file").show();var o=n.closest(".field-item").attr("data-class");if("CMB_Image_Field"===o){var u={action:"cmb_request_image",id:r.attributes.id,width:n.width(),height:n.height(),crop:s.attr("data-crop"),nonce:t.attr("data-nonce")};s.addClass("loading");jQuery.post(ajaxurl,u,function(e){jQuery("<img />",{src:e}).prependTo(s);s.removeClass("loading")}).fail(function(){jQuery("<img />",{src:r.attributes.url}).prependTo(s);s.removeClass("loading")})}else{jQuery("<img />",{src:r.attributes.icon}).prependTo(s);s.append(jQuery('<div class="cmb-file-name" />').html("<strong>"+r.attributes.filename+"</strong>"))}});i.open()});jQuery(document).on("click",".cmb-remove-file",function(e){e.preventDefault();var t=jQuery(this).parent().parent();t.find(".cmb-file-holder").html("").hide();t.find(".cmb-file-upload-input").val("");t.find(".cmb-file-upload").show().css("display","inline-block");t.find(".cmb-remove-file").hide()});var e=function(){jQuery(".cmb-file-wrap").each(function(){var e=jQuery(this),t=e.closest(".postbox"),n=t.width()-12-10-10,r=e.height()/e.width();e.attr("data-original-width")?e.width(e.attr("data-original-width")):e.attr("data-original-width",e.width());e.attr("data-original-height")?e.height(e.attr("data-original-height")):e.attr("data-original-height",e.height());if(e.width()>n){e.width(n);e.find(".cmb-file-wrap-placeholder").width(n-8);e.height(n*r);e.css("line-height",n*r+"px");e.find(".cmb-file-wrap-placeholder").height(n*r-8)}})};e();jQuery(window).resize(e)});