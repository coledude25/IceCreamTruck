/**
 * Custom jQuery for Custom Metaboxes and Fields
 *//*jslint browser: true, devel: true, indent: 4, maxerr: 50, sub: true *//*global jQuery, tb_show, tb_remove */"use strict";var CMB={_initCallbacks:[],_clonedFieldCallbacks:[],_deletedFieldCallbacks:[],init:function(){var e=this;jQuery(document).ready(function(){jQuery(".field.repeatable").each(function(){e.isMaxFields(jQuery(this))});jQuery(document).on("click",".cmb-delete-field",function(t){t.preventDefault();e.deleteField(jQuery(this).closest(".field-item"))});jQuery(document).on("click",".repeat-field",function(t){t.preventDefault();e.repeatField(jQuery(this).closest(".field"))});e.doneInit()})},repeatField:function(e){var t,n,r,e,i,s;t=this;if(t.isMaxFields(e,1))return;n=e.children(".field-item.hidden");r=n.clone();r.removeClass("hidden");var o="[type=submit],[type=button],[type=checkbox],[type=radio],[readonly]";r.find("input").not(o).val("");r.find(".cmb_upload_status").html("");r.insertBefore(n);i=0;s=["id","name","for","data-id","data-name"];e.children(".field-item").not(n).each(function(){var t=e.hasClass("CMB_Group_Field")?/cmb-group-(\d|x)*/g:/cmb-field-(\d|x)*/g,n=e.hasClass("CMB_Group_Field")?"cmb-group-"+i:"cmb-field-"+i;jQuery(this).find("["+s.join("],[")+"]").each(function(){for(var e=0;e<s.length;e++)typeof jQuery(this).attr(s[e])!="undefined"&&jQuery(this).attr(s[e],jQuery(this).attr(s[e]).replace(t,n))});i+=1});t.clonedField(r)},deleteField:function(e){var t=e.closest(".field");this.isMaxFields(t,-1);this.deletedField(e);e.remove()},isMaxFields:function(e,t){var n,r,i,s,n;t=t?parseInt(t,10):0;r=e.children(".repeat-field");n=e.children(".field-item").not(".hidden").length+t;s=e.attr("data-rep-max");e.find("> .field-item > .cmb-delete-field, > .field-item > .group > .cmb-delete-field").show();if(typeof s=="undefined")return!1;n>=parseInt(s,10)?r.attr("disabled","disabled"):r.removeAttr("disabled");if(n>parseInt(s,10))return!0},addCallbackForInit:function(e){this._initCallbacks.push(e)},doneInit:function(){var e=this,t=e._initCallbacks;if(t)for(var n=0;n<t.length;n++)t[n]()},addCallbackForClonedField:function(e,t){if(jQuery.isArray(e))for(var n=0;n<e.length;n++)CMB.addCallbackForClonedField(e[n],t);this._clonedFieldCallbacks[e]=this._clonedFieldCallbacks[e]?this._clonedFieldCallbacks[e]:[];this._clonedFieldCallbacks[e].push(t)},clonedField:function(e){var t=this;e.add(e.find("div[data-class]")).each(function(e,n){n=jQuery(n);var r=t._clonedFieldCallbacks[n.attr("data-class")];if(r)for(var i=0;i<r.length;i++)r[i](n)})},addCallbackForDeletedField:function(e,t){if(jQuery.isArray(e))for(var n=0;n<e.length;n++)CMB._deletedFieldCallbacks(e[n],t);this._deletedFieldCallbacks[e]=this._deletedFieldCallbacks[e]?this._deletedFieldCallbacks[e]:[];this._deletedFieldCallbacks[e].push(t)},deletedField:function(e){var t=this;e.add(e.find("div[data-class]")).each(function(e,n){n=jQuery(n);var r=t._deletedFieldCallbacks[n.attr("data-class")];if(r)for(var i=0;i<r.length;i++)r[i](n)})}};jQuery(document).ready(function(){CMB.init()});